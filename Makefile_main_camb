#Files containing evolution equations initial power spectrum module
EQUATIONS     = equations
POWERSPECTRUM = power_tilt
REIONIZATION = reionization
RECOMBINATION = recfast
MODULES = modules
CMBMAIN = cmbmain
CAMBFILE = camb

#Module doing non-linear scaling
NONLINEAR     = halofit

#Driver program
DRIVER        = inidriver.F90
DRIVER        = sigma8.f90
DRIVER        = tester.f90

CAMBLIB       = libcamb.a

#Shouldn't need to change anything else...
HEALPIXLD     = -L$(HEALPIXDIR)/lib -lhealpix -L$(FITSDIR) -l$(FITSLIB)

CAMBOBJ       = constants.o utils.o subroutines.o inifile.o \
	$(POWERSPECTRUM).o $(RECOMBINATION).o $(REIONIZATION).o $(MODULES).o \
	bessels.o $(EQUATIONS).o $(NONLINEAR).o lensing.o $(CMBMAIN).o $(CAMBFILE).o

default: camb

all: camb $(CAMBLIB) powspec

subroutines.o: constants.o utils.o
$(POWERSPECTRUM).o: subroutines.o  inifile.o
$(RECOMBINATION).o: subroutines.o inifile.o
$(REIONIZATION).o: constants.o inifile.o
$(MODULES).o: $(REIONIZATION).o $(RECOMBINATION).o $(POWERSPECTRUM).o
bessels.o: $(MODULES).o
$(EQUATIONS).o: bessels.o
$(NONLINEAR).o:  $(MODULES).o
lensing.o: bessels.o
$(CMBMAIN).o: lensing.o $(NONLINEAR).o $(EQUATIONS).o
$(CAMBFILE).o: $(CMBMAIN).o

camb: $(MODPKOBJ) $(CAMBOBJ) $(DRIVER)
	$(F90C) $(F90FLAGS) $(MODPKOBJ) $(CAMBOBJ) $(DRIVER) -o $@

$(CAMBLIB): $(MODPKOBJ) $(CAMBOBJ)
	ar -r $@ $?

camb_fits: writefits.f90 $(CAMBOBJ) $(DRIVER)
	$(F90C) $(F90FLAGS) -I$(HEALPIXDIR)/include $(CAMBOBJ) writefits.f90 $(DRIVER) $(HEALPIXLD) -DWRITE_FITS -o $@

	$(F90C) $(F90FLAGS) -c utils.F90	
