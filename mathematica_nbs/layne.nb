Notebook[{

Cell[CellGroupData[{
Cell["ModeCode Engine", "Title",
 CellChangeTimes->{3.580857601837193*^9}],

Cell["Multifield Background and Perturbation Solver", "Subtitle",
 CellChangeTimes->{3.580857609893817*^9}],

Cell[CellGroupData[{

Cell["Define Potential and Derivatives", "Section",
 CellChangeTimes->{3.580857623625631*^9}],

Cell[CellGroupData[{

Cell["Main Functions", "Subsection",
 CellChangeTimes->{{3.581818362729276*^9, 3.581818364153115*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Symbol", "[", 
        RowBox[{"\"\<\[Phi]\>\"", "<>", 
         RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "[", "\[Alpha]", "]"}],
       "&"}], ",", 
     RowBox[{"Range", "[", "d", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Phi]", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Symbol", "[", 
        RowBox[{"\"\<d\[Phi]\>\"", "<>", 
         RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "[", "\[Alpha]", "]"}],
       "&"}], ",", 
     RowBox[{"Range", "[", "d", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Symbol", "[", 
       RowBox[{"\"\<\[Psi]\>\"", "<>", 
        RowBox[{"ToString", "[", "i", "]"}], "<>", 
        RowBox[{"ToString", "[", "j", "]"}]}], "]"}], "[", "\[Alpha]", "]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "d"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "d"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d\[Psi]", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Symbol", "[", 
        RowBox[{"\"\<d\[Psi]\>\"", "<>", 
         RowBox[{"ToString", "[", "i", "]"}], "<>", 
         RowBox[{"ToString", "[", "j", "]"}]}], "]"}], "[", "\[Alpha]", "]"}],
       ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "d"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "d"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]funct", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Symbol", "[", 
       RowBox[{"\"\<\[Phi]\>\"", "<>", 
        RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     RowBox[{"Range", "[", "d", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Phi]funct", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Symbol", "[", 
       RowBox[{"\"\<d\[Phi]\>\"", "<>", 
        RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], ",", 
     RowBox[{"Range", "[", "d", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]funct", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Symbol", "[", 
      RowBox[{"\"\<\[Psi]\>\"", "<>", 
       RowBox[{"ToString", "[", "i", "]"}], "<>", 
       RowBox[{"ToString", "[", "j", "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "d"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "d"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d\[Psi]funct", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Symbol", "[", 
       RowBox[{"\"\<d\[Psi]\>\"", "<>", 
        RowBox[{"ToString", "[", "i", "]"}], "<>", 
        RowBox[{"ToString", "[", "j", "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "d"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "d"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.58076651484524*^9, 3.580766516841665*^9}, {
   3.580766684887984*^9, 3.58076670950583*^9}, {3.580771325628658*^9, 
   3.58077137533566*^9}, 3.580777734726744*^9, 3.580778534084891*^9, {
   3.580857932786527*^9, 3.580857932999793*^9}, {3.581020293522963*^9, 
   3.581020306835473*^9}, 3.581021673034738*^9, 3.581028833318485*^9, {
   3.581185853580558*^9, 3.581185854833504*^9}, {3.581792275031411*^9, 
   3.581792333220522*^9}, 3.581792381772754*^9, 3.581792420827781*^9, {
   3.581792459858867*^9, 3.58179247354288*^9}, {3.581792701843554*^9, 
   3.581792704473783*^9}, {3.581792797589153*^9, 3.581792802148273*^9}, {
   3.58179303578547*^9, 3.581793037131644*^9}, 3.581794365472498*^9, {
   3.581794502291735*^9, 3.581794521961071*^9}, {3.581794599794373*^9, 
   3.581794644611677*^9}, {3.581794773504659*^9, 3.581794775414118*^9}, {
   3.581799054038178*^9, 3.581799113910938*^9}, {3.581800500562105*^9, 
   3.581800564468481*^9}, {3.581801738856018*^9, 3.581801753268105*^9}, {
   3.581803989016215*^9, 3.581804088477104*^9}, {3.581809369029639*^9, 
   3.581809461775414*^9}, {3.581809556002589*^9, 3.581809574834245*^9}, {
   3.581810157804114*^9, 3.581810164827559*^9}, {3.581810961712966*^9, 
   3.581810980116521*^9}, 3.581811571379063*^9, 3.581811833974686*^9, {
   3.581817925340361*^9, 3.581818041002819*^9}, {3.58181810060978*^9, 
   3.581818284694063*^9}, {3.581818330950488*^9, 3.58181837748828*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model Definition", "Subsection",
 CellChangeTimes->{{3.581818370872563*^9, 3.581818373944757*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"m2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "10.422895047377294"}], ")"}]}], ",", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "10.422895047377294"}], "+", 
         RowBox[{"Log10", "[", "81.0", "]"}]}], ")"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"V", ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1.", "/", "2"}], ")"}], 
    RowBox[{"m2", ".", 
     RowBox[{"(", 
      RowBox[{"\[Phi]", "*", "\[Phi]"}], ")"}]}]}]}], " ", 
  RowBox[{"(*", "Scalar", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"dVd\[Phi]", ":=", 
    RowBox[{"m2", "*", "\[Phi]", "  ", 
     RowBox[{"(*", "Vector", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"m2matrix", ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"m2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"m2", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}]}]}], " ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Hessian", " ", "matrix", " ", "for", " ", "V"}], ",", " ", 
     RowBox[{
      RowBox[{"ddV", "/", "d\[Phi]_id\[Phi]"}], "_j"}]}], "*)"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"\[CapitalLambda]", "=", "6.8*^-6"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"M", "=", ".03"}], ";", "\[IndentingNewLine]", 
    RowBox[{"\[Mu]", "=", "500"}], ";", "\[IndentingNewLine]", 
    RowBox[{"\[Nu]", "=", ".015"}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"V", ":=", 
     RowBox[{
      SuperscriptBox["\[CapitalLambda]", "4"], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", "-", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"\[Phi]", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "2"], 
            SuperscriptBox["M", "2"]]}], ")"}], "2"], "+", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"\[Phi]", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "2"], 
         SuperscriptBox["\[Mu]", "2"]], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox[
           RowBox[{"\[Phi]", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "2"], 
          SuperscriptBox[
           RowBox[{"\[Phi]", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "2"]}], 
         SuperscriptBox["\[Nu]", "4"]]}], ")"}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"V", ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1.", "/", "2"}], ")"}], 
     RowBox[{"m2", ".", 
      RowBox[{"(", 
       RowBox[{"\[Phi]", "*", "\[Phi]"}], ")"}]}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"dVd\[Phi]", ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"D", "[", 
     RowBox[{"V", ",", 
      RowBox[{"\[Phi]", "[", 
       RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"m2matrix", ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"D", "[", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"V", ",", 
        RowBox[{"\[Phi]", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"\[Phi]", "[", 
       RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.5818184200602*^9, 3.581818424139499*^9}, {
  3.581818854553588*^9, 3.581818861264436*^9}, {3.581818987023914*^9, 
  3.581818989488575*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Cosmology Functions --- scalars", "Section",
 CellChangeTimes->{{3.580857731993374*^9, 3.580857755986649*^9}}],

Cell[CellGroupData[{

Cell["General", "Subsection",
 CellChangeTimes->{{3.581191010073071*^9, 3.58119101059491*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Epsilon]", ":=", 
   RowBox[{
    FractionBox["1", "2"], 
    RowBox[{"d\[Phi]", ".", "d\[Phi]"}]}]}], " ", 
  RowBox[{"(*", 
   RowBox[{"Also", " ", "=", " ", 
    RowBox[{"KE", "/", 
     SuperscriptBox["H", "2"]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"H", ":=", 
   RowBox[{"Sqrt", "[", 
    FractionBox["V", 
     RowBox[{"3.", "-", "\[Epsilon]"}]], "]"}]}], 
  RowBox[{"(*", 
   RowBox[{"G", "=", 
    RowBox[{
     RowBox[{
      SuperscriptBox[
       SubscriptBox["M", "P"], "2"], "/", "8"}], "\[Pi]"}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"H2", ":=", 
   FractionBox["V", 
    RowBox[{"3.", "-", "\[Epsilon]"}]]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KE", ":=", 
   RowBox[{"H2", " ", "\[Epsilon]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"weqnstate", ":=", 
  RowBox[{
   RowBox[{
    FractionBox["2", "3"], "\[Epsilon]"}], "-", "1."}]}]}], "Input",
 CellChangeTimes->{{3.580674681551624*^9, 3.580674760363608*^9}, {
   3.580675130019357*^9, 3.580675133586377*^9}, {3.580675377707961*^9, 
   3.580675399253677*^9}, {3.58067548600621*^9, 3.58067549229268*^9}, {
   3.580676284943541*^9, 3.580676298150949*^9}, {3.580676708968756*^9, 
   3.580676803894329*^9}, {3.580676923743787*^9, 3.580676953972595*^9}, 
   3.580677097783474*^9, {3.580679619145484*^9, 3.580679634540499*^9}, {
   3.580682183859893*^9, 3.580682191118032*^9}, {3.580683168451305*^9, 
   3.580683169847095*^9}, {3.580684776181261*^9, 3.58068477659755*^9}, {
   3.580684827571977*^9, 3.580684828209452*^9}, {3.580684951643981*^9, 
   3.58068495449289*^9}, {3.580758961393017*^9, 3.580759018176546*^9}, {
   3.580764383917068*^9, 3.580764404163507*^9}, 3.580764530079741*^9, {
   3.580771409436032*^9, 3.580771421577495*^9}, {3.580773358504419*^9, 
   3.580773472226832*^9}, {3.580773795241287*^9, 3.580773831822586*^9}, {
   3.580776431957805*^9, 3.580776432398422*^9}, {3.580848188713658*^9, 
   3.580848232654896*^9}, {3.580857854780174*^9, 3.580857858142083*^9}, {
   3.581023121101023*^9, 3.581023134253608*^9}, {3.581109115139641*^9, 
   3.581109142950095*^9}, 3.581113540276611*^9, {3.581191536849046*^9, 
   3.581191626561059*^9}, {3.58179253703637*^9, 3.581792576125676*^9}, {
   3.581792611061491*^9, 3.581792616367651*^9}, {3.58179274463269*^9, 
   3.5817927471141*^9}, {3.581810913527629*^9, 3.581810930696608*^9}, {
   3.581811583575349*^9, 3.581811589134884*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Slow Roll", "Subsection",
 CellChangeTimes->{{3.581191001753367*^9, 3.581191004328622*^9}}],

Cell[BoxData[{
 RowBox[{"\[Epsilon]SR", ":=", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"2", 
     SuperscriptBox["V", "2"]}]], 
   RowBox[{"dVd\[Phi]", ".", "dVd\[Phi]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"HSR", ":=", 
  RowBox[{"Sqrt", "[", 
   FractionBox["V", "3."], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"H2SR", ":=", 
  FractionBox["V", "3"]}]}], "Input",
 CellChangeTimes->{{3.581191409319173*^9, 3.581191470255642*^9}, {
  3.581191508103404*^9, 3.581191530798353*^9}, {3.581191609999913*^9, 
  3.581191685225795*^9}, {3.581191847339027*^9, 3.581191854179633*^9}, {
  3.581792622721102*^9, 3.581792638749942*^9}, {3.581810936002124*^9, 
  3.581810946305415*^9}, {3.581811593755767*^9, 3.581811606509178*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Set Parameters and Initial Conditions", "Section",
 CellChangeTimes->{3.58085764356358*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"\[Phi]0", "=", 
    RowBox[{"{", 
     RowBox[{"10.31001", ",", "12.93651"}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"\[Phi]0", "=", 
     RowBox[{"{", 
      RowBox[{"13", ",", "13"}], "}"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"\[Phi]crit", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Sqrt", "[", "2", "]"}], 
      FractionBox[
       SuperscriptBox["\[Nu]", "2"], "M"], "\[IndentingNewLine]", "\[Phi]0"}],
      "=", 
     RowBox[{"{", 
      RowBox[{"\[Phi]crit", ",", "0"}], "}"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"d\[Phi]0", "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["dVd\[Phi]", 
       RowBox[{"3", " ", "H2SR"}]]}], "/.", 
     RowBox[{"Thread", "[", 
      RowBox[{"\[Phi]", "\[Rule]", "\[Phi]0"}], "]"}]}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"slow", " ", "roll", " ", 
    RowBox[{"w", "/", "negligble"}], " ", "KE", " ", "contrib"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Set", " ", "other"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a0", "=", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Npivot", "=", "55"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", ":=", 
   RowBox[{"a0", " ", 
    RowBox[{"Exp", "[", "\[Alpha]", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Mpc2Mpl", "=", "2.6245*^-57"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kpivot", "=", 
    RowBox[{".002", " ", "Mpc2Mpl"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
   "Specify", " ", "in", " ", "Mpc", " ", "and", " ", "converts", " ", "to", 
    " ", 
    SuperscriptBox[
     SubscriptBox["M", "Pl"], 
     RowBox[{"-", "1"}]]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.580682758555876*^9, 3.580682794439814*^9}, {
   3.580682951205136*^9, 3.58068295706301*^9}, {3.580683230166759*^9, 
   3.580683235082072*^9}, 3.580683732992644*^9, {3.580684287353712*^9, 
   3.580684288003732*^9}, {3.580684378266436*^9, 3.580684412512316*^9}, {
   3.580684858044544*^9, 3.58068486185786*^9}, {3.580759776123397*^9, 
   3.580759782894651*^9}, 3.58076011008255*^9, {3.5807603594566*^9, 
   3.580760360177565*^9}, {3.580762317702638*^9, 3.580762327696071*^9}, {
   3.580762549502399*^9, 3.58076256834792*^9}, {3.580762631476859*^9, 
   3.580762636428616*^9}, {3.580762747121856*^9, 3.58076275941746*^9}, {
   3.580764562793563*^9, 3.580764636488595*^9}, {3.580771765088671*^9, 
   3.580771769073398*^9}, {3.580776595901836*^9, 3.580776599757095*^9}, 
   3.580777591175517*^9, 3.58077854044252*^9, {3.580853460016531*^9, 
   3.580853473701898*^9}, {3.58085784531953*^9, 3.58085784910684*^9}, 
   3.580857967789596*^9, {3.581016056497684*^9, 3.581016061872933*^9}, {
   3.581016147585834*^9, 3.581016151843206*^9}, {3.581017354656852*^9, 
   3.581017373148123*^9}, {3.581100425626936*^9, 3.581100428341454*^9}, {
   3.581101415642912*^9, 3.581101419101285*^9}, 3.581110055593028*^9, {
   3.581110327594866*^9, 3.581110330997781*^9}, {3.581110754623985*^9, 
   3.581110757510044*^9}, {3.58111355285756*^9, 3.581113552919378*^9}, 
   3.581113613604075*^9, {3.581113655369458*^9, 3.581113690113758*^9}, {
   3.581113998668329*^9, 3.581113998723929*^9}, 3.581124133539538*^9, {
   3.581124191973198*^9, 3.581124199710063*^9}, {3.581124258487084*^9, 
   3.58112426015324*^9}, {3.581124307385537*^9, 3.581124311581691*^9}, {
   3.581124383517005*^9, 3.581124384801209*^9}, {3.581124532944949*^9, 
   3.581124534559438*^9}, {3.581124831912974*^9, 3.581124836141021*^9}, {
   3.581124871017408*^9, 3.581124871576567*^9}, {3.581124914033505*^9, 
   3.581124916892855*^9}, {3.581125066318525*^9, 3.581125090353993*^9}, {
   3.581125217108664*^9, 3.581125276307027*^9}, {3.581125410928985*^9, 
   3.581125442289007*^9}, {3.58112548218662*^9, 3.581125482728389*^9}, {
   3.581191822546079*^9, 3.581191860709602*^9}, {3.581792613474452*^9, 
   3.581792613903431*^9}, {3.581792673483923*^9, 3.581792696363975*^9}, {
   3.581792958911081*^9, 3.581792971241225*^9}, {3.581793097500478*^9, 
   3.581793106025579*^9}, {3.581793148973813*^9, 3.581793160757672*^9}, {
   3.581818454562202*^9, 3.581818459613905*^9}, {3.581818529214969*^9, 
   3.581818557429977*^9}, {3.581818879757875*^9, 3.581818884870221*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Background Solver", "Section",
 CellChangeTimes->{{3.580857682233987*^9, 3.580857685026706*^9}}],

Cell["Evolve background until end of inflation", "Text",
 CellChangeTimes->{{3.580857697635353*^9, 3.580857699025787*^9}}],

Cell[CellGroupData[{

Cell["Background Equations", "Subsection",
 CellChangeTimes->{{3.580857784161415*^9, 3.580857786058447*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"kgeqn", "=", 
   RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{"Thread", ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"d\[Phi]", ",", "\[Alpha]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"3", "-", "\[Epsilon]"}], ")"}], "d\[Phi]"}], "+", 
          RowBox[{
           RowBox[{"(", 
            FractionBox["1", "H2"], ")"}], "dVd\[Phi]"}]}], "\[Equal]", "0"}],
         ",", "\[IndentingNewLine]", " ", 
        RowBox[{"d\[Phi]", "\[Equal]", 
         RowBox[{"D", "[", 
          RowBox[{"\[Phi]", ",", "\[Alpha]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Phi]", "\[Equal]", "\[Phi]0"}], "/.", 
         RowBox[{"\[Alpha]", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"d\[Phi]", "\[Equal]", "d\[Phi]0"}], "/.", 
         RowBox[{"\[Alpha]", "\[Rule]", "0"}]}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.580673182243431*^9, 3.580673191753762*^9}, {
   3.580673990271602*^9, 3.580674009395801*^9}, {3.580674090885081*^9, 
   3.580674091579571*^9}, 3.580675183046353*^9, {3.580675216976145*^9, 
   3.5806752340151*^9}, {3.580675281933912*^9, 3.580675358320064*^9}, {
   3.580675504082036*^9, 3.580675542061685*^9}, {3.580675580760197*^9, 
   3.580675625336132*^9}, {3.580676856923152*^9, 3.580676888361354*^9}, 
   3.580677513208761*^9, {3.580678823068553*^9, 3.580678866143317*^9}, {
   3.580679419654574*^9, 3.580679485282382*^9}, {3.580679568737988*^9, 
   3.580679577978491*^9}, {3.580679638630309*^9, 3.580679639743004*^9}, {
   3.580679712678544*^9, 3.580679728324394*^9}, {3.580680793748465*^9, 
   3.58068081158615*^9}, 3.58068097979736*^9, {3.580681509768722*^9, 
   3.58068151393727*^9}, {3.580681777179855*^9, 3.580681805970356*^9}, {
   3.580682330325386*^9, 3.580682399430808*^9}, 3.580759321245052*^9, 
   3.580760330060726*^9, {3.580762003001998*^9, 3.580762035335165*^9}, {
   3.580762069378211*^9, 3.580762072152883*^9}, 3.580762285598848*^9, {
   3.580764445698*^9, 3.580764449651905*^9}, {3.580765449270306*^9, 
   3.580765484730804*^9}, 3.580771524387938*^9, {3.580773661257434*^9, 
   3.58077367401275*^9}, 3.580773775617428*^9, {3.580773862853437*^9, 
   3.580773864824641*^9}, 3.580776586048234*^9, {3.580850213525798*^9, 
   3.580850221960537*^9}, {3.580857788455001*^9, 3.580857788916102*^9}, 
   3.581016144984848*^9, 3.581022943184361*^9, {3.58119187839069*^9, 
   3.581191884992493*^9}, {3.581793180248965*^9, 3.581793282957102*^9}, {
   3.5817934121578*^9, 3.581793412949224*^9}, {3.581793453776967*^9, 
   3.581793475993228*^9}, {3.581793516975273*^9, 3.58179358530042*^9}, {
   3.58179378992583*^9, 3.581793863141632*^9}, {3.581793912056661*^9, 
   3.581793921513438*^9}, {3.581793956888621*^9, 3.581793965845653*^9}, {
   3.581794061071242*^9, 3.581794064953805*^9}, 3.581794135096944*^9, {
   3.581794296679143*^9, 3.581794301450989*^9}, {3.581799236292056*^9, 
   3.581799262935459*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Engine", "Subsection",
 CellChangeTimes->{{3.580857794777887*^9, 3.580857795234956*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "Needs", "[", "\"\<DifferentialEquations`InterpolatingFunctionAnatomy`\>\"",
    "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.580857834707092*^9, 3.580857834904495*^9}, 
   3.581793378074007*^9, {3.581817846630626*^9, 3.581817849070244*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Alpha]end", "=", "1000000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"background", "=", 
  RowBox[{"NDSolve", "[", 
   RowBox[{"kgeqn", ",", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{"\[Phi]funct", ",", "d\[Phi]funct"}], "}"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]end"}], "}"}], ",", 
    RowBox[{"Method", " ", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<EventLocator\>\"", ",", 
       RowBox[{"\"\<Event\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\[Epsilon]", "-", "1."}], "}"}]}]}], "}"}]}], ",", 
    RowBox[{"Method", "\[Rule]", "\"\<BDF\>\""}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Alpha]end", " ", "=", " ", 
  RowBox[{
   RowBox[{"InterpolatingFunctionDomain", "[", 
    RowBox[{"First", "[", 
     RowBox[{"\[Phi]1", "/.", "background"}], "]"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Alpha]exit", "=", 
  RowBox[{"\[Alpha]end", "-", "Npivot"}]}]}], "Input",
 CellChangeTimes->{{3.580680277915251*^9, 3.580680280099182*^9}, {
   3.580680400932314*^9, 3.580680418277269*^9}, {3.580680603645959*^9, 
   3.580680626378966*^9}, 3.580680864238819*^9, {3.580680917390745*^9, 
   3.580680918864588*^9}, 3.58068096463529*^9, {3.580681099058112*^9, 
   3.580681103472931*^9}, {3.580681281489835*^9, 3.580681289201413*^9}, {
   3.580682065550435*^9, 3.580682068754941*^9}, {3.580682384534755*^9, 
   3.580682391145324*^9}, {3.580683307031961*^9, 3.58068339785706*^9}, {
   3.580683442052231*^9, 3.580683491670694*^9}, {3.580683637191966*^9, 
   3.580683676842484*^9}, 3.580684437936914*^9, {3.580684527855185*^9, 
   3.580684598291595*^9}, {3.580684920352086*^9, 3.580684935753966*^9}, {
   3.580685158722582*^9, 3.580685159509133*^9}, {3.580762058301507*^9, 
   3.58076206420022*^9}, {3.580771633115419*^9, 3.580771641844033*^9}, {
   3.580771676509135*^9, 3.580771722219262*^9}, {3.580771804139577*^9, 
   3.580771809331786*^9}, {3.580848002238932*^9, 3.580848056783169*^9}, 
   3.580849201119838*^9, {3.580849822051678*^9, 3.580849921459274*^9}, 
   3.58084997158396*^9, {3.580850085047724*^9, 3.580850086713695*^9}, {
   3.580850117687199*^9, 3.580850131431683*^9}, {3.580850168372328*^9, 
   3.580850251225759*^9}, {3.580850375984724*^9, 3.580850381329697*^9}, {
   3.58085070291783*^9, 3.580850755424419*^9}, {3.580850785678675*^9, 
   3.580850818940458*^9}, {3.580850937149891*^9, 3.580850939124289*^9}, {
   3.580851533479801*^9, 3.580851580252033*^9}, {3.580852207950959*^9, 
   3.580852218211034*^9}, {3.580852804513773*^9, 3.580852807543163*^9}, {
   3.58085292231547*^9, 3.580852925961234*^9}, {3.580852959440255*^9, 
   3.58085298411834*^9}, {3.580853018872848*^9, 3.580853029522147*^9}, {
   3.580857032631649*^9, 3.580857033786414*^9}, {3.580857688533246*^9, 
   3.580857700700214*^9}, {3.580860407333777*^9, 3.580860407595338*^9}, {
   3.580861278704232*^9, 3.580861279990953*^9}, {3.580862370890885*^9, 
   3.580862376223106*^9}, {3.581016050746611*^9, 3.581016051463242*^9}, {
   3.581018594312417*^9, 3.581018599529719*^9}, 3.581022953865452*^9, 
   3.581109148753227*^9, {3.581109504510836*^9, 3.581109515314204*^9}, {
   3.581793343412706*^9, 3.5817933638629*^9}, 3.581794143985484*^9, {
   3.581799096887413*^9, 3.581799099215396*^9}, {3.581799140911847*^9, 
   3.58179915150376*^9}, 3.581802433229134*^9, {3.581817759672314*^9, 
   3.581817764928401*^9}, {3.58181857501509*^9, 3.581818581329329*^9}, {
   3.581818615912756*^9, 3.581818617706111*^9}, 3.581818897457162*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Renormalize a by ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["a", "*"], 
     SubscriptBox["H", "*"]}], "=", 
    SubscriptBox["k", "*"]}], TraditionalForm]]],
 " and get horizon crossing values and \[Alpha] to start ptb equations at"
}], "Subsection",
 CellChangeTimes->{{3.580861023668371*^9, 3.580861077975693*^9}, {
  3.580861242857991*^9, 3.580861255289499*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Hpivot", "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"H", "/.", "background"}], "/.", 
       RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]exit"}]}], ")"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a0", "=", 
   FractionBox["kpivot", 
    RowBox[{"Hpivot", " ", 
     RowBox[{"Exp", "[", "\[Alpha]exit", "]"}]}]]}], " ", 
  RowBox[{"(*", 
   RowBox[{"kpivot", " ", "already", " ", "in", " ", 
    SuperscriptBox[
     SubscriptBox["M", "Pl"], 
     RowBox[{"-", "1"}]]}], "*)"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"a", " ", "H"}], "-", 
       FractionBox["kpivot", "100"]}], "}"}], "/.", "background"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", "\[Alpha]exit"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Alpha]ptbstart", "=", 
    RowBox[{"\[Alpha]", "/.", "%"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"a0", "=", 
    RowBox[{"a", "/.", 
     RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]ptbstart"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.580860367572458*^9, 3.580860530023329*^9}, {
   3.580860575079484*^9, 3.580860596466883*^9}, {3.580860659217977*^9, 
   3.580860768699755*^9}, {3.580860836404599*^9, 3.580860971243172*^9}, {
   3.580861022604508*^9, 3.580861026164611*^9}, {3.580861175489301*^9, 
   3.580861227715222*^9}, {3.580861264661178*^9, 3.580861286134427*^9}, {
   3.580862391917366*^9, 3.58086239749883*^9}, {3.581016683431369*^9, 
   3.581016692805796*^9}, {3.581016800934469*^9, 3.581016801722385*^9}, {
   3.581019359714939*^9, 3.581019366046967*^9}, {3.58102063071803*^9, 
   3.581020668259669*^9}, {3.581021137089752*^9, 3.581021148454119*^9}, {
   3.581021203338404*^9, 3.581021228874886*^9}, 3.5810227597146*^9, {
   3.581022815551893*^9, 3.581022819696647*^9}, 3.581022959697576*^9, {
   3.581028260493553*^9, 3.581028267234335*^9}, {3.581100274122412*^9, 
   3.581100275787448*^9}, 3.581100416150756*^9, {3.581100448747607*^9, 
   3.58110046836569*^9}, {3.581110440606107*^9, 3.581110446440688*^9}, 
   3.581113566661958*^9, 3.581113648952278*^9, {3.581191902464095*^9, 
   3.581191930213539*^9}, {3.581194571344841*^9, 3.581194572564584*^9}, {
   3.581799304346898*^9, 3.581799392237546*^9}, {3.581799457671463*^9, 
   3.581799483350595*^9}, {3.581799520550308*^9, 3.581799593001469*^9}, {
   3.581801853795759*^9, 3.581801890393706*^9}, {3.581802438357125*^9, 
   3.581802438526446*^9}, {3.581813053585409*^9, 3.581813083009423*^9}, {
   3.581813801459838*^9, 3.581813803246048*^9}, {3.581815082011605*^9, 
   3.581815144575752*^9}, {3.581817752134648*^9, 3.581817757423485*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perturbation Equations", "Section",
 CellChangeTimes->{{3.580861334401608*^9, 3.580861336685036*^9}}],

Cell["\<\
NOTE: Now time translate background values by time when perturbation \
equations needs to start \[Alpha]ptbstart.  Everything from here down is in \
\[OpenCurlyDoubleQuote]perturbation time.\[CloseCurlyDoubleQuote]\
\>", "Subsection",
 CellChangeTimes->{{3.581737775262983*^9, 3.581737799476516*^9}}],

Cell[CellGroupData[{

Cell[TextData[{
 "ICs for perturbation mode matrix ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Psi]", "IJ"], TraditionalForm]]],
 " in Bunch-Davies vacuum (See Salopek, Bond, Bardeen) based on background \
values when ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["a", "*"], 
     SubscriptBox["H", "*"]}], "=", 
    RowBox[{
     SubscriptBox["k", "*"], "/", "100"}]}], TraditionalForm]]]
}], "Subsection",
 CellChangeTimes->{
  3.58086141069607*^9, {3.580862245105057*^9, 3.580862256738156*^9}, {
   3.581023661097605*^9, 3.581023680505942*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Phi]ptbstart", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"\[Phi]", "/.", "background"}], "/.", 
     RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]ptbstart"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Phi]ptbstart", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"d\[Phi]", "/.", "background"}], "/.", 
     RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]ptbstart"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Hptbstart", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"H", "/.", "background"}], "/.", 
      RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]ptbstart"}]}], ")"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Psi]0", "[", "k_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    FractionBox["1", 
     RowBox[{"Sqrt", "[", 
      RowBox[{"2", "k"}], "]"}]], ")"}], 
   RowBox[{"IdentityMatrix", "[", "d", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"d\[Psi]0", "[", "k_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"-", 
      FractionBox["I", 
       RowBox[{"a", " ", "Hptbstart"}]]}], " ", ")"}], 
    RowBox[{"Sqrt", "[", 
     FractionBox["k", "2"], "]"}], " ", 
    RowBox[{"IdentityMatrix", "[", "d", "]"}]}], "/.", 
   RowBox[{"\[Alpha]", "\[Rule]", "0"}]}]}]}], "Input",
 CellChangeTimes->{{3.580677514716848*^9, 3.580677547165261*^9}, {
   3.58067763171722*^9, 3.580677642842213*^9}, {3.580677691201236*^9, 
   3.580677728165931*^9}, {3.580679843069592*^9, 3.580679848817861*^9}, 
   3.580679892823028*^9, {3.580680668070113*^9, 3.580680686535397*^9}, {
   3.580752809607461*^9, 3.580752812456493*^9}, {3.580773489714766*^9, 
   3.580773491346333*^9}, {3.580773928098813*^9, 3.580773939284613*^9}, {
   3.580776910123605*^9, 3.580776920931807*^9}, {3.580861339617579*^9, 
   3.580861377928152*^9}, {3.580862080649263*^9, 3.580862081805961*^9}, {
   3.581016274921014*^9, 3.581016275312068*^9}, {3.581016314472056*^9, 
   3.581016318504898*^9}, {3.581016542114808*^9, 3.581016566858336*^9}, {
   3.581016647305286*^9, 3.581016648158736*^9}, 3.581016706207596*^9, {
   3.581017140002659*^9, 3.581017156340859*^9}, {3.581018355597426*^9, 
   3.581018363054618*^9}, {3.581019226652143*^9, 3.581019238621931*^9}, {
   3.581020918071293*^9, 3.581020920232683*^9}, {3.581021463620774*^9, 
   3.581021493402217*^9}, {3.581021538210041*^9, 3.581021593029205*^9}, {
   3.581024570382129*^9, 3.581024571250366*^9}, {3.581028357332115*^9, 
   3.581028358053155*^9}, {3.581120920023119*^9, 3.581120962003296*^9}, 
   3.581121979449176*^9, {3.581122564015896*^9, 3.581122570350265*^9}, {
   3.581123876747123*^9, 3.581123885687554*^9}, {3.581186862882294*^9, 
   3.581186881231845*^9}, 3.581186917410612*^9, {3.581186955876768*^9, 
   3.581186973128772*^9}, {3.581191941266215*^9, 3.581191973601731*^9}, {
   3.58173588325187*^9, 3.581735937853459*^9}, {3.581737819375191*^9, 
   3.581737846759939*^9}, 3.581790498899282*^9, {3.581799717830883*^9, 
   3.581799783890976*^9}, {3.581799815033738*^9, 3.58179985440902*^9}, {
   3.581799908275372*^9, 3.581799912725917*^9}, {3.581799974153152*^9, 
   3.581799976406917*^9}, {3.581800054740749*^9, 3.581800105494975*^9}, {
   3.581801826230328*^9, 3.581801852316841*^9}, {3.581801893523171*^9, 
   3.581801909891153*^9}, {3.581814339717693*^9, 3.58181436687007*^9}, 
   3.581815206718743*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions for ptbs", "Subsection",
 CellChangeTimes->{3.580861399931349*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ptbmassmatrix", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        FractionBox["1.", "H2"], ")"}], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m2matrix", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], "+", 
         RowBox[{
          RowBox[{"d\[Phi]", "[", 
           RowBox[{"[", "i", "]"}], "]"}], 
          RowBox[{"dVd\[Phi]", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"dVd\[Phi]", "[", 
           RowBox[{"[", "i", "]"}], "]"}], 
          RowBox[{"d\[Phi]", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"3.", "-", "\[Epsilon]"}], ")"}], 
       RowBox[{"d\[Phi]", "[", 
        RowBox[{"[", "i", "]"}], "]"}], 
       RowBox[{"d\[Phi]", "[", 
        RowBox[{"[", "j", "]"}], "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "d"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "d"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.580677017382814*^9, 3.580677049393753*^9}, {
   3.580677145465765*^9, 3.580677215646185*^9}, {3.580677320178735*^9, 
   3.580677371538552*^9}, {3.580678095791572*^9, 3.580678102750582*^9}, {
   3.580678136011087*^9, 3.580678140068411*^9}, {3.580678318019066*^9, 
   3.580678351319561*^9}, {3.580678383730328*^9, 3.580678392645887*^9}, {
   3.580678632775383*^9, 3.580678764824156*^9}, {3.580679911800038*^9, 
   3.580679912441682*^9}, 3.58068163227066*^9, 3.580681752321387*^9, {
   3.580766527983409*^9, 3.580766528962391*^9}, {3.58077693819866*^9, 
   3.580776968481544*^9}, 3.580776999920064*^9, {3.580843910516673*^9, 
   3.580843912906079*^9}, 3.580861384845894*^9, 3.580861416774145*^9, {
   3.580861512921514*^9, 3.580861514529205*^9}, {3.580861555424964*^9, 
   3.58086155718249*^9}, {3.580861853668294*^9, 3.580861923175093*^9}, {
   3.581018267793787*^9, 3.581018282609487*^9}, {3.581019883160957*^9, 
   3.581019895925774*^9}, {3.581019930931962*^9, 3.581019949252155*^9}, {
   3.581020333039264*^9, 3.581020335501047*^9}, {3.581021373810465*^9, 
   3.581021376321595*^9}, {3.581030024297091*^9, 3.581030027662826*^9}, {
   3.581191981675585*^9, 3.581191987242748*^9}, {3.581800141126127*^9, 
   3.581800163662167*^9}, {3.581800212833879*^9, 3.581800258982004*^9}, {
   3.581804338758907*^9, 3.581804411809531*^9}, {3.581804553880893*^9, 
   3.581804554269289*^9}, {3.581808989229401*^9, 3.581809109068486*^9}, {
   3.581810665850722*^9, 3.581810668985605*^9}, 3.581811023672794*^9, {
   3.58181293899567*^9, 3.581812940257417*^9}, {3.581814240140288*^9, 
   3.581814240573284*^9}, 3.581814742626768*^9, {3.581814824431289*^9, 
   3.581814830571741*^9}, {3.581814915837056*^9, 3.581814927456245*^9}, 
   3.581815282689656*^9, {3.581815764366969*^9, 3.581815768429992*^9}, {
   3.581817718714235*^9, 3.581817718913457*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perturbed, Fourier-transformed Equations", "Subsection",
 CellChangeTimes->{{3.580861431321576*^9, 3.580861439227191*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ptbeqn", "=", 
    RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"d\[Psi]", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", "\[Alpha]"}], "]"}],
           "\[Equal]", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"(", 
              RowBox[{"1", "-", "\[Epsilon]"}], ")"}]}], 
            RowBox[{"d\[Psi]", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                FractionBox["kpivot", 
                 RowBox[{"a", " ", "H"}]], ")"}], "2"], "-", "2", "+", 
              "\[Epsilon]"}], ")"}], 
            RowBox[{"\[Psi]", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "-", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ptbmassmatrix", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "l"}], "]"}], "]"}], 
              RowBox[{"\[Psi]", "[", 
               RowBox[{"[", 
                RowBox[{"l", ",", "j"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"l", ",", "d"}], "}"}]}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"\[Psi]", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", "\[Alpha]"}], "]"}],
           "\[Equal]", 
          RowBox[{"d\[Psi]", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"\[Psi]", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"\[Psi]0", "[", "kpivot", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "/.", 
          RowBox[{"\[Alpha]", "\[Rule]", "0"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"d\[Psi]", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "\[Equal]", 
           RowBox[{
            RowBox[{"d\[Psi]0", "[", "kpivot", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "/.", 
          RowBox[{"\[Alpha]", "\[Rule]", "0"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], "}"}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"backeqn", "=", 
   RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
    RowBox[{"Map", "[", 
     RowBox[{"Thread", ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"d\[Phi]", ",", "\[Alpha]"}], "]"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"3", "-", "\[Epsilon]"}], ")"}], "d\[Phi]"}], "+", 
          RowBox[{
           RowBox[{"(", 
            FractionBox["1", "H2"], ")"}], "dVd\[Phi]"}]}], "\[Equal]", "0"}],
         ",", "\[IndentingNewLine]", " ", 
        RowBox[{"d\[Phi]", "\[Equal]", 
         RowBox[{"D", "[", 
          RowBox[{"\[Phi]", ",", "\[Alpha]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Phi]", "\[Equal]", "\[Phi]ptbstart"}], "/.", 
         RowBox[{"\[Alpha]", "\[Rule]", "0"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"d\[Phi]", "\[Equal]", "d\[Phi]ptbstart"}], "/.", 
         RowBox[{"\[Alpha]", "\[Rule]", "0"}]}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fulleqn", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"ptbeqn", ",", "backeqn"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.580678117953779*^9, 3.580678126050189*^9}, {
   3.580678787067428*^9, 3.580678817313135*^9}, {3.580678852283752*^9, 
   3.580678900225189*^9}, {3.580679120123327*^9, 3.580679313894092*^9}, {
   3.580679344230327*^9, 3.580679408985338*^9}, {3.580679696766883*^9, 
   3.580679702875322*^9}, {3.580679754462746*^9, 3.580679834215451*^9}, {
   3.580679885269579*^9, 3.580679886341009*^9}, {3.580680698987757*^9, 
   3.580680720587971*^9}, 3.580680777497466*^9, {3.580776948812899*^9, 
   3.580777017490957*^9}, {3.580861441378842*^9, 3.580861441728028*^9}, {
   3.580861576356232*^9, 3.580861605778849*^9}, {3.580861636207748*^9, 
   3.580861745241759*^9}, 3.581016289392781*^9, {3.581016326879495*^9, 
   3.58101633540519*^9}, {3.581016412167259*^9, 3.581016432706567*^9}, {
   3.581016656147826*^9, 3.581016669010982*^9}, 3.581017164137957*^9, {
   3.581017836648186*^9, 3.581017839165462*^9}, {3.581019139227153*^9, 
   3.581019163564673*^9}, {3.581019249282745*^9, 3.581019311672375*^9}, {
   3.581019555774236*^9, 3.581019561149734*^9}, {3.581019608841438*^9, 
   3.581019631317381*^9}, {3.581020409577232*^9, 3.581020423181994*^9}, 
   3.581020902564185*^9, {3.581020937124782*^9, 3.5810209990597*^9}, {
   3.581021061635434*^9, 3.581021122605478*^9}, 3.581021323318601*^9, {
   3.581021400621139*^9, 3.581021408658088*^9}, {3.581021642674058*^9, 
   3.581021646374222*^9}, {3.581022437001797*^9, 3.581022440754794*^9}, {
   3.581024700859285*^9, 3.581024704728448*^9}, 3.581024886983018*^9, {
   3.581028367126455*^9, 3.581028441168804*^9}, {3.581028527823369*^9, 
   3.581028536342776*^9}, {3.581028698550883*^9, 3.581028793363576*^9}, {
   3.581028975713616*^9, 3.581029012802355*^9}, {3.581029376661534*^9, 
   3.581029466074291*^9}, {3.581029627272117*^9, 3.581029710381566*^9}, {
   3.581029765154381*^9, 3.58102980277321*^9}, {3.581099061535013*^9, 
   3.581099083164635*^9}, {3.581099407537268*^9, 3.581099408938094*^9}, {
   3.581099446549917*^9, 3.581099447335103*^9}, {3.58109948305082*^9, 
   3.58109956692342*^9}, {3.581102773541575*^9, 3.581102777269443*^9}, {
   3.581103200939432*^9, 3.581103202350064*^9}, 3.581103424968124*^9, 
   3.581120876957618*^9, 3.581186370631814*^9, {3.581192063419022*^9, 
   3.581192082577107*^9}, {3.581192118943347*^9, 3.581192249950664*^9}, {
   3.581192282817771*^9, 3.581192285194783*^9}, 3.581196857955626*^9, 
   3.581734766302851*^9, {3.581735524799501*^9, 3.581735594550671*^9}, {
   3.581735703793553*^9, 3.581735750627966*^9}, 3.581737856810261*^9, {
   3.581800347541566*^9, 3.581800414251481*^9}, 3.58180049633086*^9, 
   3.581800580859981*^9, {3.58180071067286*^9, 3.58180071772594*^9}, {
   3.581801216706776*^9, 3.581801218796889*^9}, {3.581801299908688*^9, 
   3.581801361636752*^9}, {3.581801391995756*^9, 3.581801466383602*^9}, {
   3.58180153567915*^9, 3.581801601456511*^9}, {3.581801705267399*^9, 
   3.581801730383766*^9}, {3.581801782712416*^9, 3.581801798023619*^9}, {
   3.581801935220319*^9, 3.581801949825853*^9}, {3.581801997097336*^9, 
   3.581802005310877*^9}, {3.58180210266489*^9, 3.581802103078428*^9}, {
   3.581802262833753*^9, 3.581802264114658*^9}, 3.581802504192222*^9, {
   3.581802544316878*^9, 3.581802569524302*^9}, {3.581802627736663*^9, 
   3.581802678149618*^9}, 3.58180291652147*^9, 3.581802982902249*^9, {
   3.581803082609713*^9, 3.581803099359407*^9}, {3.581803150516923*^9, 
   3.58180320046574*^9}, {3.581803240762049*^9, 3.581803258680381*^9}, {
   3.581803292944417*^9, 3.581803312612403*^9}, {3.581803391754357*^9, 
   3.581803401783999*^9}, {3.581803485124556*^9, 3.581803509654408*^9}, {
   3.581803751752767*^9, 3.581803802576335*^9}, {3.581804568803123*^9, 
   3.581804679439347*^9}, {3.58180471167361*^9, 3.581804720974459*^9}, {
   3.581809167551576*^9, 3.581809182939053*^9}, 3.581809272304758*^9, 
   3.581809507379419*^9, {3.581809726542431*^9, 3.581809735759955*^9}, {
   3.581809910043749*^9, 3.581809911934954*^9}, 3.581810062993374*^9, 
   3.581810224548491*^9, 3.581810348801054*^9, 3.581810442468935*^9, 
   3.58181106456365*^9, 3.581811132943846*^9, {3.581811314733259*^9, 
   3.58181131483137*^9}, {3.581811676583094*^9, 3.581811679241519*^9}, 
   3.581811818977867*^9, {3.58181185573522*^9, 3.581811866604953*^9}, 
   3.58181190613976*^9, 3.581812529435385*^9, {3.581812595421891*^9, 
   3.581812596004542*^9}, {3.581812776816663*^9, 3.581812799625372*^9}, {
   3.581815294849976*^9, 3.581815305878636*^9}, 3.581815689152548*^9, {
   3.581815943255062*^9, 3.581815952392856*^9}, 3.581816047197477*^9, {
   3.581816091920543*^9, 3.581816095033969*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Perturbation Solver", "Section",
 CellChangeTimes->{{3.58101866118611*^9, 3.581018663578479*^9}}],

Cell["Evolve the background again, too?", "Text",
 CellChangeTimes->{{3.58180251884968*^9, 3.581802528098275*^9}, 
   3.581802975802286*^9, {3.581812766385465*^9, 3.581812769217674*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Alpha]ptbend", "=", 
   RowBox[{"\[Alpha]end", "-", "\[Alpha]ptbstart"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"perturbations", "=", 
  RowBox[{"NDSolve", "[", 
   RowBox[{"fulleqn", ",", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
      "\[Phi]funct", ",", "d\[Phi]funct", ",", "\[Psi]funct", ",", 
       "d\[Psi]funct"}], "}"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]ptbend"}], "}"}], ",", 
    RowBox[{"Method", "\[Rule]", "\"\<ExplicitRungeKutta\>\""}], ",", 
    RowBox[{"AccuracyGoal", "\[Rule]", "20"}], ",", 
    RowBox[{"MaxSteps", "\[Rule]", "Infinity"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.581018513474157*^9, 3.581018549975283*^9}, {
   3.581018583647374*^9, 3.581018587906247*^9}, {3.581018679611301*^9, 
   3.581018679800067*^9}, {3.581021009900079*^9, 3.581021013834379*^9}, {
   3.581021256946977*^9, 3.58102126351027*^9}, 3.581022449243966*^9, {
   3.581022532367184*^9, 3.581022534418724*^9}, {3.581023373547568*^9, 
   3.581023376597538*^9}, {3.5810234456989*^9, 3.581023446495043*^9}, {
   3.581024985838308*^9, 3.581024990986388*^9}, {3.581025358025839*^9, 
   3.581025359442021*^9}, {3.581025689811959*^9, 3.581025713613794*^9}, {
   3.581025858873425*^9, 3.58102585900554*^9}, {3.581025894251704*^9, 
   3.581025923177401*^9}, 3.58102595915778*^9, {3.581028421796294*^9, 
   3.581028421961252*^9}, {3.581028538505994*^9, 3.581028554917521*^9}, {
   3.581028662467747*^9, 3.581028695983664*^9}, {3.581029018591624*^9, 
   3.581029068606206*^9}, {3.581029117909729*^9, 3.581029126181575*^9}, 
   3.581029260919246*^9, 3.581099090958651*^9, {3.581099128119029*^9, 
   3.581099142236141*^9}, {3.581099400199413*^9, 3.581099475452018*^9}, 
   3.581099528337769*^9, {3.581099609190239*^9, 3.581099629251879*^9}, {
   3.581100800348412*^9, 3.581100856642622*^9}, {3.5811030243193*^9, 
   3.581103084476979*^9}, {3.5811037934846*^9, 3.581103794457368*^9}, {
   3.581103913373595*^9, 3.581103941118917*^9}, {3.581106008240695*^9, 
   3.581106016611587*^9}, {3.58110626585487*^9, 3.58110626802489*^9}, {
   3.581106849952413*^9, 3.581106850255253*^9}, 3.581110369877507*^9, {
   3.581190928666359*^9, 3.581190931585638*^9}, {3.581192903410112*^9, 
   3.581192903526695*^9}, 3.581734770773187*^9, 3.581735597952561*^9, 
   3.581735746316165*^9, {3.581735970727286*^9, 3.581735986612779*^9}, {
   3.581736340665435*^9, 3.581736346337231*^9}, {3.581736894973149*^9, 
   3.581736896007554*^9}, {3.581801619744451*^9, 3.581801653681046*^9}, {
   3.581801962922493*^9, 3.581801967722381*^9}, {3.581802110508318*^9, 
   3.581802111501113*^9}, {3.58180246833036*^9, 3.581802490824474*^9}, {
   3.58180257355036*^9, 3.581802585810412*^9}, {3.581803264654661*^9, 
   3.581803269558699*^9}, {3.581803322822662*^9, 3.581803367615917*^9}, {
   3.581803498823616*^9, 3.581803503141883*^9}, {3.581803664622348*^9, 
   3.581803687604453*^9}, {3.581804683151262*^9, 3.58180470147468*^9}, {
   3.581809225339154*^9, 3.581809266354759*^9}, {3.581809698548926*^9, 
   3.581809702946373*^9}, 3.581810087331139*^9, {3.581810368202956*^9, 
   3.581810421381955*^9}, {3.581810506786539*^9, 3.581810565686391*^9}, {
   3.581811151952601*^9, 3.581811184051859*^9}, 3.581811224634773*^9, {
   3.581811683287837*^9, 3.581811702842303*^9}, 3.581811881818409*^9, {
   3.581815317652085*^9, 3.581815321440668*^9}, {3.581815410875492*^9, 
   3.581815414324687*^9}, {3.581815970978752*^9, 3.581815982379077*^9}, {
   3.581816106934567*^9, 3.581816117528652*^9}, {3.581816321177*^9, 
   3.581816341596077*^9}, {3.581816432756593*^9, 3.581816437989374*^9}, {
   3.581817649359323*^9, 3.581817660007272*^9}}],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Re", "[", 
      RowBox[{"\[Psi]", "/.", "perturbations"}], "]"}], ",", 
     RowBox[{"Im", "[", 
      RowBox[{"\[Psi]", "/.", "perturbations"}], "]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]ptbend"}], "}"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.581816228876644*^9, 3.581816290627907*^9}, 
   3.58181644504879*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Power Spectrum", "Section",
 CellChangeTimes->{{3.581023840577506*^9, 3.581023842656553*^9}}],

Cell[CellGroupData[{

Cell["Slow-Roll Approximation for Power Spectrum", "Subsection",
 CellChangeTimes->{{3.581191733265774*^9, 3.581191740728502*^9}}],

Cell[BoxData[{
 RowBox[{"PowerSpectrumHorizonCross", "=", 
  RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      FractionBox["V", 
       RowBox[{"24", " ", 
        SuperscriptBox["\[Pi]", "2"]}]], 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "\[Epsilon]SR"], ",", 
        FractionBox["1", "\[Epsilon]"]}], "}"}]}], "/.", "perturbations"}], "/.", 
    RowBox[{"\[Alpha]", "\[Rule]", 
     RowBox[{"\[Alpha]exit", "-", "\[Alpha]ptbstart"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"PowerSpectrumSR", "=", 
  RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      FractionBox["Npivot", 
       RowBox[{"4", " ", 
        SuperscriptBox["\[Pi]", "2"]}]], " ", 
      RowBox[{"{", 
       RowBox[{"H2SR", ",", "H2"}], "}"}]}], "/.", "perturbations"}], "/.", 
    RowBox[{"\[Alpha]", "\[Rule]", 
     RowBox[{"\[Alpha]exit", "-", "\[Alpha]ptbstart"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.581191742965776*^9, 3.58119174808555*^9}, {
   3.581194444085299*^9, 3.581194560206105*^9}, {3.581195453502811*^9, 
   3.581195521330216*^9}, 3.581195580843091*^9, {3.581195617988141*^9, 
   3.581195722880807*^9}, {3.581197072641759*^9, 3.581197080023364*^9}, {
   3.581734778269116*^9, 3.581734780031992*^9}, {3.58173700349927*^9, 
   3.581737005360466*^9}, {3.581807410012004*^9, 3.581807475058157*^9}, {
   3.581808731558279*^9, 3.581808735719693*^9}, {3.581815480413538*^9, 
   3.581815490920262*^9}, {3.581816454837251*^9, 3.581816500093604*^9}, 
   3.581816546110061*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Numerical Evaluation", "Subsection",
 CellChangeTimes->{{3.581195316049045*^9, 3.581195318769663*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PowerSpectrum", ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      FractionBox[
       SuperscriptBox["kpivot", "3"], 
       RowBox[{"2", 
        SuperscriptBox["\[Pi]", "2"], 
        SuperscriptBox["a", "2"]}]], 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "l"}], "]"}], "]"}], " ", 
         RowBox[{
          RowBox[{"Conjugate", "[", "\[Psi]", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"j", ",", "l"}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"l", ",", "d"}], "}"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"d\[Phi]0", ":=", 
  RowBox[{"Sqrt", "[", 
   RowBox[{"d\[Phi]", ".", "d\[Phi]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Omega]", ":=", 
  FractionBox["d\[Phi]", "d\[Phi]0"]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PowerSpectrumAdiabatic", ":=", 
   RowBox[{
    RowBox[{"(", 
     FractionBox["1.0", 
      RowBox[{"2.0", "\[Epsilon]"}]], ")"}], 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Omega]", "[", 
        RowBox[{"[", "i", "]"}], "]"}], " ", 
       RowBox[{"\[Omega]", "[", 
        RowBox[{"[", "j", "]"}], "]"}], " ", 
       RowBox[{"PowerSpectrum", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<Numerical -- Inflation End: \>\"", ",", 
   RowBox[{
    RowBox[{"PowerSpectrumAdiabatic", "/.", "perturbations"}], "/.", 
    RowBox[{"\[Alpha]", "\[Rule]", "\[Alpha]ptbend"}]}], ",", 
   "\[IndentingNewLine]", "\"\<\\nNumerical -- Horiz Cross: \>\"", ",", " ", 
   RowBox[{
    RowBox[{"PowerSpectrumAdiabatic", "/.", "perturbations"}], "/.", 
    RowBox[{"\[Alpha]", "\[Rule]", 
     RowBox[{"\[Alpha]exit", "-", "\[Alpha]ptbstart"}]}]}], ",", 
   "\[IndentingNewLine]", " ", "\"\<\\nSlowroll: \>\"", ",", 
   RowBox[{"PowerSpectrumSR", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", " ", 
   "\"\<\\nHorizon Crossing: \>\"", ",", 
   RowBox[{"PowerSpectrumHorizonCross", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]"}], "Input",
 
 CellChangeTimes->{{3.581736269747134*^9, 3.581736327053114*^9}, {
   3.581736392517582*^9, 3.581736425211635*^9}, {3.581736469108526*^9, 
   3.581736492050415*^9}, {3.581736552343098*^9, 3.581736764143012*^9}, {
   3.581737118979015*^9, 3.581737329559367*^9}, 3.58173786813163*^9, {
   3.581737914011403*^9, 3.581737937260807*^9}, {3.581807493425232*^9, 
   3.58180751926317*^9}, {3.5818075785075*^9, 3.581807606095302*^9}, {
   3.581807741042421*^9, 3.581807847429579*^9}, 3.58180791446892*^9, {
   3.581807976141334*^9, 3.581807978100341*^9}, {3.581808366178011*^9, 
   3.581808377585486*^9}, {3.581808602005547*^9, 3.581808602543329*^9}, {
   3.581808693438534*^9, 3.581808722988791*^9}, {3.58180878685101*^9, 
   3.581808883188045*^9}, {3.581809154823331*^9, 3.581809155320278*^9}, {
   3.581816157669617*^9, 3.581816165013748*^9}, 3.581816473151315*^9, {
   3.581816636420503*^9, 3.581816664909028*^9}, 3.58181672363389*^9, {
   3.581816775042318*^9, 3.581816778701931*^9}, {3.581816838107293*^9, 
   3.581816840126969*^9}, {3.581816884801918*^9, 3.581816987077641*^9}}],

Cell[BoxData[{
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"PowerSpectrum", "/.", "perturbations"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]ptbend"}], "}"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Style", "[", 
        RowBox[{"#", ",", "20"}], "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Alpha]", "-", 
         SubscriptBox["\[Alpha]", "start"]}], ",", 
        SubscriptBox["P", "IJ"]}], "}"}]}], "]"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"laynepk", "=", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"PowerSpectrumAdiabatic", "/.", "perturbations"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"\[Alpha]exit", "-", "\[Alpha]ptbstart"}], ",", 
      "\[Alpha]ptbend"}], "}"}], ",", 
    RowBox[{"GridLines", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "\[Alpha]exit", "}"}], ",", 
       RowBox[{"{", "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Style", "[", 
         RowBox[{"#", ",", "20"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Alpha]", "-", 
          SubscriptBox["\[Alpha]", "start"]}], ",", 
         SubscriptBox["P", "\[Zeta]\[Zeta]"]}], "}"}]}], "]"}]}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", "ThickRed", "}"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.581187716860069*^9, 3.581187757282834*^9}, {
   3.581187918841856*^9, 3.581187922785975*^9}, {3.581188086363215*^9, 
   3.581188153492138*^9}, {3.581196720279841*^9, 3.5811967833894*^9}, 
   3.581735200694722*^9, {3.581735306038451*^9, 3.581735324411457*^9}, 
   3.581735957565095*^9, {3.581735996200313*^9, 3.581735999540376*^9}, {
   3.581736244007571*^9, 3.581736252264998*^9}, {3.581736287990309*^9, 
   3.581736303388208*^9}, {3.581736859835638*^9, 3.581736880156253*^9}, {
   3.581737127305766*^9, 3.581737127450693*^9}, {3.581737601585133*^9, 
   3.581737649652005*^9}, {3.581807920572999*^9, 3.581807935307444*^9}, {
   3.581807995924458*^9, 3.581808051758508*^9}, {3.581808626787037*^9, 
   3.581808637498091*^9}, {3.581816190218779*^9, 3.581816212099722*^9}, {
   3.581817004756897*^9, 3.581817028605835*^9}, {3.581817266601848*^9, 
   3.581817274323602*^9}, {3.581817425731653*^9, 3.581817433939415*^9}, {
   3.581819184965399*^9, 3.581819195712357*^9}, {3.581819577721919*^9, 
   3.581819602374694*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{"\"\<agreement.pdf\>\"", ",", 
   RowBox[{"Show", "[", 
    RowBox[{"laynepk", ",", "jonnyplot"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.581819664885643*^9, 3.581819713020861*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other Plots", "Section",
 CellChangeTimes->{{3.580857804769645*^9, 3.580857805251494*^9}, {
  3.581195329409052*^9, 3.581195329872547*^9}}],

Cell[BoxData[{
 RowBox[{"plotfrommathematica", "=", 
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"ParametricPlot", "[", 
     RowBox[{
      RowBox[{"\[Phi]", "/.", "background"}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]end"}], "}"}], ",", 
      RowBox[{"Frame", "\[Rule]", "True"}], ",", 
      RowBox[{"PlotStyle", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Black", ",", "Thick"}], "}"}]}], ",", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
      RowBox[{"FrameLabel", "\[Rule]", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Style", "[", 
           RowBox[{"#", ",", "20"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["\[Phi]", "1"], ",", 
           SubscriptBox["\[Phi]", "2"]}], "}"}]}], "]"}]}]}], "]"}], ",", 
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Phi]", "[", "0", "]"}], "}"}], "/.", "background"}], ",", 
      RowBox[{"PlotMarkers", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", "Medium"}], "}"}]}], ",", 
      RowBox[{"PlotStyle", "\[Rule]", "Black"}], ",", 
      RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ParametricPlot", "[", 
    RowBox[{
     RowBox[{"d\[Phi]", "/.", "background"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]end"}], "}"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", "Thick", "}"}]}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Style", "[", 
         RowBox[{
          SubscriptBox["d\[Phi]", "1"], ",", "20"}], "]"}], ",", 
        RowBox[{"Style", "[", 
         RowBox[{
          SubscriptBox["d\[Phi]", "2"], ",", "20"}], "]"}]}], "}"}]}]}], 
    "]"}], ",", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d\[Phi]", "[", "0", "]"}], "}"}], "/.", "background"}], ",", 
     RowBox[{"PlotMarkers", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Automatic", ",", "Medium"}], "}"}]}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", "Black"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.580680893952681*^9, 3.580680898960688*^9}, {
  3.580680933437632*^9, 3.580680959485598*^9}, {3.580681113476451*^9, 
  3.580681166497718*^9}, {3.580681200283665*^9, 3.580681201867835*^9}, {
  3.580681239131625*^9, 3.580681292647827*^9}, {3.580684616378604*^9, 
  3.580684630443976*^9}, {3.580774066100922*^9, 3.580774121185184*^9}, {
  3.580776698024071*^9, 3.580776790641773*^9}, {3.58077682353939*^9, 
  3.580776850916659*^9}, {3.580779986599825*^9, 3.580780019626999*^9}, {
  3.580780140272175*^9, 3.580780172042385*^9}, {3.580842326025479*^9, 
  3.580842361839114*^9}, {3.581808069898853*^9, 3.581808120610989*^9}}],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Epsilon]", "/.", "background"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", "0", ",", "\[Alpha]end"}], "}"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Style", "[", 
       RowBox[{"\[Alpha]", ",", "20"}], "]"}], ",", 
      RowBox[{"Style", "[", 
       RowBox[{"\"\<\[Epsilon]\>\"", ",", "20"}], "]"}]}], "}"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.580773493062811*^9, 3.580773616256361*^9}, {
   3.580773750650866*^9, 3.580773761294973*^9}, {3.580773876699273*^9, 
   3.58077392254605*^9}, {3.580773973636447*^9, 3.580774042792511*^9}, {
   3.58077430699439*^9, 3.580774309367785*^9}, {3.58077435038489*^9, 
   3.580774409479475*^9}, {3.580776865960073*^9, 3.580776884010333*^9}, {
   3.580848075329956*^9, 3.580848086065151*^9}, {3.58102377247876*^9, 
   3.581023781889172*^9}, 3.58110916298096*^9, {3.581114099632639*^9, 
   3.581114100649552*^9}, {3.581808127788782*^9, 3.581808145138364*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "SetDirectory", "[", 
     "\"\</home/lpri691/Cosmology_Research/F_projects/ModeCode/ModeCode_\
multifield/mathematica_nbs\>\"", "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"\"\<phiarr.txt\>\"", ",", "\"\<Table\>\""}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data\[Alpha]", "=", 
     RowBox[{"data", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data\[Phi]1", "=", 
     RowBox[{"data", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"data\[Phi]2", "=", 
     RowBox[{"data", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"plotfrommodecode", "=", 
    RowBox[{"ListPlot", "[", 
     RowBox[{"Thread", "[", 
      RowBox[{"{", 
       RowBox[{"data\[Phi]1", ",", "data\[Phi]2"}], "}"}], "]"}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.580778815655106*^9, 3.580778881901794*^9}, {
  3.580778929410619*^9, 3.580778971691516*^9}, {3.580779007509588*^9, 
  3.580779017188981*^9}, {3.580779446182857*^9, 3.580779446509118*^9}, {
  3.580779523974566*^9, 3.580779524639291*^9}, {3.58077988021363*^9, 
  3.580779976734118*^9}, {3.581737691964715*^9, 3.581737693134506*^9}}],

Cell[BoxData[
 RowBox[{"compare", "=", 
  RowBox[{"Show", "[", 
   RowBox[{"plotfrommathematica", ",", "plotfrommodecode"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.58077998010501*^9, 3.580779999083439*^9}, {
  3.580780036683686*^9, 3.580780037259289*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1621, 1026},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
FrontEndVersion->"8.0 for Linux x86 (32-bit) (October 10, 2011)",
StyleDefinitions->"Default.nb"
]

