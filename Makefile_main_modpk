#Driver for standalone P(k) code
#PKDRIVER	= driver_modpk.f90
PKDRIVER	= multimodecode_driver.f90


F90FLAGS      = $(FFLAGS)

MODPKOBJ = dvode_f90_m.o \
					 csv_file.o \
					 modpk_io.o \
					 modpk_modules.o modpk_numerics.o \
					 modpk_qsf.o modpk_rng.o \
  				 modpk_potential.o modpk_icsampling.o \
					 modpk_utils.o  modpk_odeint.o \
					 modpk_backgrnd.o modpk.o # modpk_postprocessing.o


default: powspec

csv_file.o: csv_file.f90 csv_file_1d.f90 csv_file_2d.f90
modpk_io.o: modpk_io.f90 csv_file.o
modpk_modules.o: modpk_modules.f90 csv_file.o modpk_io.o
modpk_numerics.o: modpk_numerics.f90 modpk_modules.o
modpk_qsf.o: modpk_qsf.f90 modpk_modules.o modpk_numerics.o
modpk_potential.o: modpk_modules.o modpk_potential.f90 modpk_qsf.o
modpk_rng.o: modpk_modules.o modpk_rng.f90
modpk_icsampling.o: modpk_modules.o modpk_potential.o modpk_rng.o modpk_icsampling.f90
modpk_utils.o: modpk_modules.o modpk_potential.o modpk_icsampling.o modpk_utils.f90
modpk_odeint.o:  modpk_modules.o modpk_io.o modpk_io.o modpk_potential.o modpk_icsampling.o \
 	modpk_utils.o dvode_f90_m.o modpk_odeint.f90
modpk_backgrnd.o: modpk_odeint.o modpk_backgrnd.f90
modpk.o: modpk_backgrnd.o modpk.f90
dvode_f90_m.o: dvode_f90_m.f90

powspec : $(MODPKOBJ) $(PKDRIVER)
	$(F90C) $(F90FLAGS) $(MODPKOBJ) $(PKDRIVER) -o $@

%.o %.mod: %.f90
	$(F90C) $(F90FLAGS) -c $*.f90

clean: cleanoutput
	-rm -f *.o *.a *.d core *.mod
	-rm powspec

cleanoutput:
	-rm fort.*
	-rm *.dat
	-rm out_fields_infl_end.txt
	-rm out_fields_horizon_cross.txt
	-rm out_powerspectra.txt
	-rm out_trajectory.txt
	-rm out_pk_adiab.txt
	-rm out_pk_isocurv.txt
	-rm out_modes*.txt
	-rm out_ic_eqen.txt
	-rm out_ic_eqen_SR.txt
	-rm out_ic_isoN.txt
	-rm out_ic_isoN_SR.txt
